<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Update Log Converter</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    textarea { width: 100%; height: 200px; margin-bottom: 10px; font-family: monospace; }
    button { padding: 8px 12px; margin-right: 10px; margin-bottom: 10px; }
    pre { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); white-space: pre-wrap; }
  </style>
</head>
<body>

<h1>Update Log Converter</h1>

<h2>Text Input</h2>
<textarea id="inputText" placeholder="Paste your updates in text format..."></textarea>
<br>
<button id="convert">Convert to JSON</button>
<button id="copyJSON">Copy JSON</button>

<h2>Generated JSON</h2>
<textarea id="jsonOutput" readonly></textarea>
<br>
<button id="jsonToText">Convert JSON → Text</button>
<button id="copyText">Copy Text</button>

<h2>Converted Text</h2>
<textarea id="textOutput" readonly></textarea>

<script>
const inputText = document.getElementById('inputText');
const jsonOutput = document.getElementById('jsonOutput');
const textOutput = document.getElementById('textOutput');

const convertBtn = document.getElementById('convert');
const copyJSONBtn = document.getElementById('copyJSON');
const jsonToTextBtn = document.getElementById('jsonToText');
const copyTextBtn = document.getElementById('copyText');

// ---------------- Text → JSON ----------------
function convertToJSON() {
  const text = inputText.value;
  const updates = [];
  
  const rawUpdates = text.split(/^-{3,}$/m); // split by "---"
  
  rawUpdates.forEach(raw => {
    const lines = raw.trim().split('\n').map(l => l.trim()).filter(l => l);
    if (lines.length === 0) return;
    
    const update = { version: '', date: '', sections: [] };
    let currentSection = null;

    lines.forEach(line => {
      if (line.startsWith('Version:')) {
        update.version = line.replace('Version:', '').trim();
      } else if (line.startsWith('Date:')) {
        update.date = line.replace('Date:', '').trim();
      } else if (/^[^\-]+:$/.test(line)) {
        currentSection = { title: line.replace(':','').trim(), items: [] };
        update.sections.push(currentSection);
      } else if (line.startsWith('-') && currentSection) {
        const parts = line.slice(1).split(':');
        const name = parts.shift().trim();
        const description = parts.join(':').trim();
        currentSection.items.push({ name, description });
      }
    });

    updates.push(update);
  });

  jsonOutput.value = JSON.stringify({updateLogs: updates}, null, 2);
}

convertBtn.onclick = convertToJSON;

// ---------------- Copy JSON ----------------
copyJSONBtn.onclick = () => {
  if (!jsonOutput.value) return;
  navigator.clipboard.writeText(jsonOutput.value)
    .then(() => alert('JSON copied to clipboard!'))
    .catch(err => alert('Failed to copy JSON: ' + err));
};

// ---------------- JSON → Text ----------------
function convertJSONToText() {
  let data;
  try {
    data = JSON.parse(jsonOutput.value);
  } catch (e) {
    alert('Invalid JSON!');
    return;
  }

  const lines = [];
  data.updateLogs.forEach(update => {
    lines.push(`Version: ${update.version}`);
    if (update.date) lines.push(`Date: ${update.date}`);
    update.sections.forEach(section => {
      lines.push(`${section.title}:`);
      section.items.forEach(item => {
        lines.push(`- ${item.name}: ${item.description}`);
      });
    });
    lines.push('---'); // separator between updates
  });

  textOutput.value = lines.join('\n');
}

jsonToTextBtn.onclick = convertJSONToText;

// ---------------- Copy Text ----------------
copyTextBtn.onclick = () => {
  if (!textOutput.value) return;
  navigator.clipboard.writeText(textOutput.value)
    .then(() => alert('Text copied to clipboard!'))
    .catch(err => alert('Failed to copy text: ' + err));
};
</script>

</body>
</html>
